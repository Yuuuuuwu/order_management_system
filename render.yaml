services:
  - type: web
    name: oms-backend
    env: python
    repo: https://github.com/你的用戶名/你的儲存庫名稱.git
    branch: main
    buildCommand: |
      echo "🚀 開始 Render 部署流程..." &&
      echo "📦 安裝 Python 依賴..." &&
      pip install -r requirements-render.txt &&
      echo "🔍 環境變數檢查:" &&
      echo "   FLASK_ENV: $FLASK_ENV" &&
      echo "   DATABASE_URL: ${DATABASE_URL:0:50}..." &&
      echo "🗄️ 執行資料庫遷移..." &&
      FLASK_ENV=render FLASK_APP=run.py flask db upgrade &&
      echo "🌱 載入初始資料..." &&
      FLASK_ENV=render python scripts/seed_data.py &&
      echo "✅ 部署準備完成！"
    startCommand: |
      echo "🚀 啟動 Flask 應用..." &&
      echo "   監聽端口: $PORT" &&
      echo "   環境: $FLASK_ENV" &&
      gunicorn --bind 0.0.0.0:$PORT --workers 4 --timeout 120 --access-logfile - --error-logfile - run:app
    plan: free
    environmentVariables:
      - key: FLASK_ENV
        value: render
      - key: FLASK_APP
        value: run.py
      - key: PYTHON_VERSION
        value: 3.11.4
    autoDeploy: true
    
databases:
  - name: oms-postgres
    databaseName: oms_db
    user: oms_db_user
    plan: free